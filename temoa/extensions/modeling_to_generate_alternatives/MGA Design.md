# MGA Design

## Terms
### MGA Axis:  
- The general description of the inputs to diversify.  Default now is TECH CATEGORY ACTIVITY 
implying that we will try to diversify activity of each labeled tech category in `Technology` table.
- **DIMENSION**: number of categories.  This defines the dimensionality of the convex hull
- Notions for possible Axis:
  - Techs:  All(?) techs
  - Sectors:  Does this make sense?
  - Category/Subcategory:  The Fundamental idea
  - A selection of `TechGroup` from data
  - Emissions:  Different types
  - Resilience:  Some combo of storage & capacity factor & such
### `Axis Vector`  
- Directional unit vector within the axis space
- **DIMENSION** = dimensionality of the MGA Axis
- This is a possible exploration direction within the MGA Axis space
- `Hull Norm`:  An `Axis Vector` that is normal to a facet on the convex hull
  - Hull Norms are generated by the convex hull routine
  - Must be checked for redundancy (other nearly collinear instances), especially when re-creating the hull from points
### `Model Vector`
- A vector of coefficients or model variables or both that represent the basis of the objective function
- **DIMENSION**: The total number of variables chosen within the `Vector Manager` to capture output.  This is `sample dimension`.
- Generated by the `Vector Manager`
- `Variable Vector`:  A `Model Vector` of model variables (only) selected for analysis.  
- `Coefficient Vector`:  A vector of scalar multipliers of the same length as the `Variable Vector`.
- `Input Vector`
  - A `pyomo` expression of coefficients * variables from the above.
  - Used as the Objective expression in the optimization
- `Output Vector`
  - A vector of variables (containing solution values) from an optimization run

#### Example:
MGA Axis of "activity" with 2 categories:  {`solar`,`wind`}

An `Axis Vector` might be [0.75, 0.25]

A `Variable Vector` might be:  `[activity[solar, day], activity[solar, night], activity[wind, day], activity[wind, night]]`

A `Coefficient Vector` might be:  `[0.75/2, 0.75/2, 0.25/2, 0.25/2]`

An `Input Vector` would be the sum of the dot product of variables and coefficients

### Point
- The outcome of an optimization represented in Axis space
- Can be used to define points on the Convex Hull (if used)

### Weighting Scheme
- The logic that determines new `axis vectors` for exploration
- To be implemented by the `Vector Manager`
- Options:
  - Hull Expansion:  Use the `hull norm` vectors as path for exploration.  The Hull Expansion approach looks to
  produce normal vectors to the known hull boundaries for exploration.  Initially, to construct the first instance
  of the hull, the manager will produce +/- direction unit vectors for each of the categories to identify some extreme
  points to start with.  For instance, if there are 3 categories of tech annotated {solar, wind, electric} the initial
  batch of vectors would be max/min for each of those categories independently, with the others zeroed.  Then a hull is
  built and normal vectors are employed going forward.
  - Random (?)?:  Random unit vectors in either the `Axis Vector` dimension or `Model Vector` dimension

## Implementation:
- User should specify an `Axis` in the config.  This will enable the selection of a `Vector Manager`
- User should specify a `Weighting Scheme` in the config that is appropriate for the `Axis` chosen.
This setup is only sparsely built now, but allows a framework for follow-on development
- User should verify the solver config data in the `solver_options.toml` file in the MGA pkg folder in the `extensions`
package.
- User should ensure that the `Axis` is supported in the appropriate data table.  
  - For example, if using the default, we should mark/check categories in `Technology`.  
  - Techs that have no category will be processed but not be part of the `Objective` function. 
  - If using the cvx hull algorithm, realize that `2 x |Categories|` solves are necessary to establish a hull


## Objectives & Ideas Notes:

- Look at near-optimal solutions that are diverse
- What are metrics?
  - Likely impossible to capture full output tables for any significant
number of runs
  - Flow out?  Cost?  Emissions?
  - Almost certainly capacity built.  **Capacity Built is implemented** and enumerated by dash-run
number in the `OutputBuiltCapacity` table.
- What are reasonable aggregation schemes to capture summary values?

## What kind of diversity:
- How are outcomes diverse from each other?
- Capacity of individual techs?  (likely too granular)
- Capacity of groups of techs
  - Group by?  We have sector/catagory/sub-category
  - Sector is probably a separate animal
- Flow at key chokepoints?
  - How would you find chokepoints?
- Emissions type/quantity?
  - range of emissions possible might be interesting
- Resiliency?
  - spare capacity against ___?
    - Reserve margins
    - Capacity Factors
  - aggregate storage
- Imports vs. nationalized vs. Exchange Techs
  - "self sufficiency"
  - reliance on imported commodities
  - How to capture raw materials needed for high-demand national things
    (battery storage)
- What are logical ways to label runs?  Or just a simple index?

## Single vector MGA

- How much more in one direction?

## Outputs
- Perhaps save the "weighting" index to a table for each run
to make individual points reproducible to get full output?
- What do MGA output summary results look like...?

